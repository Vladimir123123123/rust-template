using UnityEngine;

public class DismountedState : BaseDismountedState
{
	private StateStatus status = StateStatus.Error;

	public override void StateEnter(BaseAIBrain brain, BaseEntity entity)
	{
		base.StateEnter(brain, entity);
		status = StateStatus.Error;
		if (brain.PathFinder == null)
		{
			return;
		}
		AIInformationZone informationZone = (entity as HumanNPC).GetInformationZone(entity.transform.position);
		if (!(informationZone == null))
		{
			AICoverPoint bestCoverPoint = informationZone.GetBestCoverPoint(entity.transform.position, entity.transform.position, 25f, 50f, entity);
			if ((bool)bestCoverPoint)
			{
				bestCoverPoint.SetUsedBy(entity, 10f);
			}
			Vector3 pos = ((bestCoverPoint == null) ? entity.transform.position : bestCoverPoint.transform.position);
			if (brain.Navigator.SetDestination(pos, BaseNavigator.NavigationSpeed.Fast))
			{
				status = StateStatus.Running;
			}
		}
	}

	public override StateStatus StateThink(float delta, BaseAIBrain brain, BaseEntity entity)
	{
		base.StateThink(delta, brain, entity);
		if (status == StateStatus.Error)
		{
			return status;
		}
		if (brain.Navigator.Moving)
		{
			return StateStatus.Running;
		}
		return StateStatus.Finished;
	}
}
