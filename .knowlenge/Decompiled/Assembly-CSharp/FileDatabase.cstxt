using System;
using System.Collections.Generic;
using Facepunch;
using Facepunch.Sqlite;
using ProtoBuf;

private class FileDatabase : Facepunch.Sqlite.Database
{
	public IEnumerable<AssociatedFiles.AssociatedFile> QueryAll(NetworkableId entityID)
	{
		IntPtr stmHandle = Prepare("SELECT filetype, crc, part, data FROM data WHERE entid = ?");
		Facepunch.Sqlite.Database.Bind(stmHandle, 1, entityID.Value);
		return ExecuteAndReadQueryResults(stmHandle, ReadAssociatedFileRow);
	}

	private static AssociatedFiles.AssociatedFile ReadAssociatedFileRow(IntPtr stmHandle)
	{
		AssociatedFiles.AssociatedFile associatedFile = Pool.Get<AssociatedFiles.AssociatedFile>();
		associatedFile.type = Facepunch.Sqlite.Database.GetColumnValue<int>(stmHandle, 0);
		associatedFile.crc = (uint)Facepunch.Sqlite.Database.GetColumnValue<int>(stmHandle, 1);
		associatedFile.numID = (uint)Facepunch.Sqlite.Database.GetColumnValue<int>(stmHandle, 2);
		associatedFile.data = Facepunch.Sqlite.Database.GetColumnValue<byte[]>(stmHandle, 3);
		return associatedFile;
	}
}
