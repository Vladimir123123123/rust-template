using System.Collections.Generic;
using Facepunch;
using Network.Visibility;
using UnityEngine;

private class NetworkQueueList
{
	public HashSet<BaseNetworkable> queueInternal = new HashSet<BaseNetworkable>();

	public int MaxLength;

	public int Length => queueInternal.Count;

	public bool Contains(BaseNetworkable ent)
	{
		return queueInternal.Contains(ent);
	}

	public void Add(BaseNetworkable ent)
	{
		if (!Contains(ent))
		{
			queueInternal.Add(ent);
		}
		MaxLength = Mathf.Max(MaxLength, queueInternal.Count);
	}

	public void Add(BaseNetworkable[] ent)
	{
		foreach (BaseNetworkable ent2 in ent)
		{
			Add(ent2);
		}
	}

	public void Clear(Group group)
	{
		using (TimeWarning.New("NetworkQueueList.Clear"))
		{
			if (group != null)
			{
				if (group.isGlobal)
				{
					return;
				}
				List<BaseNetworkable> obj = Pool.Get<List<BaseNetworkable>>();
				foreach (BaseNetworkable item in queueInternal)
				{
					if (item == null || item.net?.group == null || item.net.group == group)
					{
						obj.Add(item);
					}
				}
				foreach (BaseNetworkable item2 in obj)
				{
					queueInternal.Remove(item2);
				}
				Pool.FreeUnmanaged(ref obj);
			}
			else
			{
				queueInternal.RemoveWhere((BaseNetworkable x) => x == null || x.net?.group == null || !x.net.group.isGlobal);
			}
		}
	}
}
