using UnityEngine;

public class WorldSpaceGrid
{
	public enum RoundingMode
	{
		Up,
		Down
	}

	public static int CalculateCellCount(float gridSize, float cellSize, RoundingMode rounding = RoundingMode.Up)
	{
		float num = 1f / cellSize;
		float f = Mathf.Max(gridSize, 1000f) * num;
		if (rounding == RoundingMode.Up)
		{
			return Mathf.CeilToInt(f);
		}
		return Mathf.FloorToInt(f);
	}

	public static Vector3 ClosestGridCell(Vector3 worldPos, float gridSize, float cellSize, RoundingMode rounding = RoundingMode.Up)
	{
		float num = 1f / cellSize;
		int num2 = CalculateCellCount(gridSize, cellSize, rounding);
		float num3 = (float)num2 * 0.5f - 0.5f;
		int v = Mathf.RoundToInt(worldPos.x * num + num3);
		int v2 = Mathf.RoundToInt(worldPos.z * num + num3);
		int num4 = Mathx.Clamp(v, 0, num2 - 1);
		v2 = Mathx.Clamp(v2, 0, num2 - 1);
		float x = ((float)num4 - num3) * cellSize;
		float z = ((float)v2 - num3) * cellSize;
		return new Vector3(x, 0f, z);
	}
}
